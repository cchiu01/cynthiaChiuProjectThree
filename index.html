<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="./styles/style.css">
    <title>Project 3</title>
    <style>

        .hide {
            display:none;
        }
    
    </style>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script>
        
        myApp = {};
        myApp.randomTrackList = [];
        myApp.playlistFileNames = [];
        myApp.start = false;
        myApp.audio = {};
        myApp.trackIndex = 0;
        myApp.score = 0;
        myApp.seconds = 10;

        myApp.data = {
                track0: {
                    title: `I Just Can't Wait to Be King`,
                    movie: `Lion King`,
                    source: 'Lion_King_I_Just_Cant_Wait_to_Be_King'
                },
                track1: {
                    title: `I'll Make A Man Out Of You`,
                    movie: `Mulan`,
                    source: 'Mulan_Ill_Make_A_Man_Out_Of_You'
                },
                track2: {
                    title: `Aladdin A Whole New World`,
                    movie: `Aladdin`,
                    source: `Aladdin_A_Whole_New_World`
                },
                track3: {
                    title: `Lion King Hakuna Matata`,
                    movie: `Lion King`,
                    source: `Lion_King_Hakuna_Matata`
                }

            };
        
        
        myApp.getTrackFileName = function (object) {
            myApp.playlistFileNames = [];
            // create an array from myApp.data.track_.source
            for (let each in object) {
                (myApp.playlistFileNames).push(object[each].source);
            } 
        };
        

        myApp.randomTrackGenerator = function (array){
            myApp.randomTrackList = [];
            // for loop condition breaks when myApp.randomTrackList.length == array.length
            for (let i= 0; myApp.randomTrackList.length < array.length; i++) {
                // generates a random number from 0 to array.length
                let index = Math.floor((Math.random() * array.length));
                // adds index to myApp.randomTrackList.length if value does not exist in newArray
                if (!myApp.randomTrackList.includes(index)) {
                    myApp.randomTrackList.push(index);
                }
            }
        };

// sets the html element is-playing = true when song is playing
        myApp.isPlaying = function (string) {
            if (string === `Lion_King_I_Just_Cant_Wait_to_Be_King` 
                || string === `Lion_King_Hakuna_Matata`) {
                $('.lion-king').attr("is-playing", true);
            }
            if (string === `Mulan_Ill_Make_A_Man_Out_Of_You`) {
                $('.mulan').attr("is-playing", true);
            }
            if (string === `Aladdin_A_Whole_New_World`) {
                $('.aladdin').attr("is-playing", true);
            }
        };

        // 
        myApp.initAudioPlayer = function (array) {
            $('.start').on('click', function () {
                myApp.countdown()
                $('.skip').removeAttr("disabled");
                $('.score').text(myApp.score);
                $(this).addClass("hide");
                myApp.audio = new Audio();
                // displays name of file based on the trackIndex from randomTrackList
                let filename = array[myApp.randomTrackList[myApp.trackIndex]];
                myApp.audio.src = './audio/' + `${filename}` + `.mp3`;
                if (!myApp.playing) {
                    myApp.audio.play(); 
                    myApp.isPlaying(filename);
                    myApp.start = true;
                }
            })
        }; 

        myApp.countdown = function () {
            let countdown = setInterval(function () {
                console.log('init')
                $('.seconds').text(myApp.seconds);

                if (myApp.seconds <= 5) {
                    $('.seconds').css('color', 'red');
                        $('.seconds').effect("shake",{distance:3}, 500);
                };

                if (myApp.seconds == 0) {
                    clearInterval(countdown);
                    $('.seconds').effect("shake", { distance: 1, times: 20 }, 800);
                }
                myApp.seconds = myApp.seconds - 1;
            }, 1000);
        };

        // +1 to score
        myApp.scoreIncrementor = function () {
            myApp.score = myApp.score + 1;
            $('.score').text(myApp.score);
        };
        
        // listening for click on is-playing for true
        // adds +1 to score
        myApp.correctCardSelected = function () {
            $('img').on('click', function () {
                if ($(this).attr("is-playing") === 'true') {
                    myApp.scoreIncrementor();
                    myApp.switchTrack(myApp.playlistFileNames);
                };
            });
        };

        // stops the track, sets the card to is-playing = false
        // trackIndex moves to next position of randomTrackList
        // next song is played
        // the corresponding movie card has attribute is-playing = true 
        myApp.switchTrack = function (array) {
                    myApp.audio.pause();
                    $('[is-playing="true"]').attr("is-playing", false);
                    myApp.trackIndex = myApp.trackIndex + 1;
                    let filename = array[myApp.randomTrackList[myApp.trackIndex]];
                    myApp.audio.src = './audio/' + `${filename}` + `.mp3`;
                    myApp.audio.play();
                    myApp.isPlaying(filename);


        };

        // when skip button is clicked, pauses the current song and plays the next song
        // sets isPlaying = true on next song
        myApp.skipTrack = function (array) {
            $('button.skip').on('click', function (){
                myApp.switchTrack(myApp.playlistFileNames);
            });
        };

    $(function (){
            myApp.getTrackFileName(myApp.data);
            myApp.randomTrackGenerator(myApp.playlistFileNames);
            myApp.initAudioPlayer(myApp.playlistFileNames);
            myApp.correctCardSelected();
            myApp.skipTrack(myApp.playlistFileNames);
            

    })
    
    </script>
</head>
<body>
    <main class = "game">
        <div class="wrapper">

        </div>

    </main>
    <button class = "start">start</button>
    <button class = "skip" disabled = "disabled">skip</button>
    <span class = 'score'></span>
    <div class = "countdown">
        <span class = "seconds"></span>
    </div>
    <div>
        <img class="lion-king" is-playing="false" src="./images/movie-00.jpg" alt="">
        <img class = "mulan" is-playing = "false" src="./images/movie-01.jpg"  alt="">
        <img class = "aladdin" is-playing = "false" src="./images/movie-02.jpg"  alt="">
    </div>
    <!-- <p class = "lionKing" is-playing = "false" >Lion King</p>
    <p class = "mulan" is-playing = "false">Mulan</p>
    <p class = "aladdin" is-playing = "false">Aladdin</p> -->
</body>
</html>