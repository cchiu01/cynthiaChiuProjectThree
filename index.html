<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Project 3</title>
    <style>
    
    </style>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script>
        
        myApp = {};
        myApp.randomTrackList = [];
        myApp.playlistFileNames = [];
        myApp.start = false;
        myApp.audio = {};
        myApp.trackIndex = 0;

        myApp.data = {
                track0: {
                    title: `I Just Can't Wait to Be King`,
                    movie: `Lion King`,
                    source: 'Lion_King_I_Just_Cant_Wait_to_Be_King'
                },
                track1: {
                    title: `I'll Make A Man Out Of You`,
                    movie: `Mulan`,
                    source: 'Mulan_Ill_Make_A_Man_Out_Of_You'
                },
                track2: {
                    title: `Aladdin A Whole New World`,
                    movie: `Aladdin`,
                    source: `Aladdin_A_Whole_New_World`
                }
            };
        
        
        myApp.getTrackFileName = function (object) {
            myApp.playlistFileNames = [];
            // create an array from myApp.data.track0.source
            for (let each in object) {
                (myApp.playlistFileNames).push(object[each].source);
            } 
        };
        

        myApp.randomTrackGenerator = function (array){
            myApp.randomTrackList = [];
            // for loop condition breaks when myApp.randomTrackList.length == array.length
            for (let i= 0; myApp.randomTrackList.length < array.length; i++) {
                // generates a random number from 0 to array.length
                let index = Math.floor((Math.random() * array.length));
                // adds index to myApp.randomTrackList.length if value does not exist in newArray
                if (!myApp.randomTrackList.includes(index)) {
                    myApp.randomTrackList.push(index);
                }
            }
        };

        myApp.isPlaying = function (string) {
            if (string === `Lion_King_I_Just_Cant_Wait_to_Be_King`) {
                $('p.lionKing').attr("is-playing", true);
            }
            if (string === `Mulan_Ill_Make_A_Man_Out_Of_You`) {
                $('p.mulan').attr("is-playing", true);
            }
            if (string === `Aladdin_A_Whole_New_World`) {
                $('p.aladdin').attr("is-playing", true);
            }
            // myApp.switchTrack(myApp.playlistFileNames);
        }


        myApp.initAudioPlayer = function (array) {
            $('button').on('click', function () {

                myApp.audio = new Audio();
                // displays name of file based on the trackIndex from randomTrackList
                let filename = array[myApp.randomTrackList[myApp.trackIndex]];
                
                // console.log(myApp.randomTrackList);
                myApp.audio.src = './audio/' + `${filename}` + `.mp3`;
                if (!myApp.playing) {
                    myApp.audio.play(); 
                    myApp.isPlaying(filename);
                    myApp.start = true;
                }
            })
        };
        
        // listening for click on is-playing for true
        // stops the track, sets the card to is-playing = false
        // trackIndex moves to next position of randomTrackList
        // next song is played
        // the corresponding movie card has attribute is-playing = true 
    
        myApp.switchTrack = function (array) {
            // $('p[is-playing="true"]').on('click', function () {
            $('p').on('click', function () {        
                if ($(this).attr("is-playing") === 'true' ) {
                    console.log('play')
                    myApp.audio.pause();
                    $(this).attr("is-playing", false);
                    myApp.trackIndex = myApp.trackIndex + 1;
                    let filename = array[myApp.randomTrackList[myApp.trackIndex]];
                    myApp.audio.src = './audio/' + `${filename}` + `.mp3`;
                    myApp.audio.play();
                    myApp.isPlaying(filename);
                }
            })

        }

    $(function (){

            myApp.getTrackFileName(myApp.data);
            myApp.randomTrackGenerator(myApp.playlistFileNames);
            myApp.initAudioPlayer(myApp.playlistFileNames);
            myApp.switchTrack(myApp.playlistFileNames);
        

    })
    
    </script>
</head>
<body>
    <button>start</button>
    <div></div>
    <p class = "lionKing" is-playing = "false" >Lion King</p>
    <p class = "mulan" is-playing = "false">Mulan</p>
    <p class = "aladdin" is-playing = "false">Aladdin</p>
</body>
</html>